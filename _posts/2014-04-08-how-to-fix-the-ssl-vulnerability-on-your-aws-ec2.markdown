---
layout: post
title: "How to fix the SSL vulnerability on your AWS EC2 or other Ubuntu/Debian based webserver"
date: 2014-04-08 12:14:50
author: maarten
categories: []
---

### UPDATE
It turns out that OpenSSL __is__ updated in the Ubuntu repos. Even though ```openssl version``` does still say ```1.0.1e```, see [http://serverfault.com/questions/587324/heartbleed-how-to-reliably-and-portably-check-the-openssl-version](http://serverfault.com/questions/587324/heartbleed-how-to-reliably-and-portably-check-the-openssl-version). 

So, in short the following should be enough to update your openssl library:

```bash
sudo apt-get update && sudo apt-get upgrade
```
Instead of rebooting, you can now just restart nginx with:

```bash
sudo service nginx restart
```

__Thanks for all responses on Twitter and Reddit!__

---

As of today, openSSL confirmed a security vulnerability in their software ([https://www.openssl.org/news/secadv_20140407.txt](https://www.openssl.org/news/secadv_20140407.txt)). We currently use Amazon Web Services EC2 to host our webapplication and as it turns out the Ubuntu VMs do indeed run the openSSL version that is affected by this security bug.

> You can see for yourself whether your webserver is vulnerable by trying it here: [http://filippo.io/Heartbleed/](http://filippo.io/Heartbleed/).

I just updated these VMs with an openSSL version that fixes this security threat and I thought some of you will find this useful. These steps should work on any Ubuntu installation, but YMMV.


##### First I checked whether I was running an OpenSSL version that is vulnerable
SSH to your VM and run the following command:

```bash
openssl version
```

It will return something along the lines of:

```bash
OpenSSL 1.0.1e 11 Feb 2013
```

Verify whether you are vulnerable by comparing it to the [bugreport](http://heartbleed.com/):
> What versions of the OpenSSL are affected?
>
> Status of different versions:
>
> * OpenSSL 1.0.1 through 1.0.1f (inclusive) are vulnerable
>
> * OpenSSL 1.0.1g is NOT vulnerable
>
> * OpenSSL 1.0.0 branch is NOT vulnerable
>
> * OpenSSL 0.9.8 branch is NOT vulnerable
>
> Bug was introduced to OpenSSL in December 2011 and has been out in the wild since OpenSSL release 1.0.1 on 14th of March 2012. OpenSSL 1.0.1g released on 7th of April 2014 fixes the bug.

##### Update your OpenSSL library
As APT does not contain a binary for the latest (fixed) OpenSSL, you will need to compile the library from source. You can do this by executing the following commands.

Download the latest TARBALL:

```bash
curl https://www.openssl.org/source/openssl-1.0.1g.tar.gz > openssl-1.0.1g.tar.gz
```

Download the respective checksum:

```bash
curl https://www.openssl.org/source/openssl-1.0.1g.tar.gz.md5 > openssl-1.0.1g.tar.gz.md5
```

Verify the checksum:

```bash
md5sum openssl-1.0.1g.tar.gz  | awk '{print $1;}' | cmp - openssl-1.0.1g.tar.gz.md5
```

If this doesnâ€™t check ok, just repeat the download. Otherwise, continue with unpacking:

```bash
tar xzf openssl-1.0.1g.tar.gz
```

Build it:

```bash
cd openssl-1.0.1g && sudo ./config && sudo make && sudo make install
```

This will take a couple of minutes to execute, after which you have to manually relink to this new binary by executing:

```bash
sudo ln -sf /usr/local/ssl/bin/openssl `which openssl`
```

Verify again if you now have the correct version by running openssl version again. You should now get:

```bash
OpenSSL 1.0.1g 7 Apr 2014
```

Unfortunately, you will have to reboot your VM to actually get your webserver to use this new version of OpenSSL. Execute

```bash
sudo reboot
```

This should only take your server offline for less than a minute.


**GOOD LUCK!**
